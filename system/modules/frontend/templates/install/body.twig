{#
    Displays the installer main content

    To see available variables:
        - without enabling Twig debug mode: {{ var_dump() }}
        - using native Twig debugger (Debug mode must be enabled): {{ dump() }}

    @package GPL Cart core
    @author Iurii Makukh <gplcart.software@gmail.com>
    @copyright Copyright (c) 2015, Iurii Makukh
    @license https://www.gnu.org/licenses/gpl.html GNU/GPLv3
    @link http://gplcart.com Support, modules, demo
#}
<body class="install">
  <div class="container">
    <form method="post" class="form-horizontal">
      <div class="row">
        <div class="col-md-12">
          <h1 class="h4">{{ text('Welcome to GPL Cart') }}</h1>
          {% if languages|length > 1 %}
              <div class="select-language clearfix">
                <span class="pull-left">{{ text ('Select a language') }}:&nbsp;&nbsp;</span>
                <ul class="list-inline languages pull-left">
                  {% for code,name in languages %}
                      <li class="{{ (code == language) ? 'active' }}">
                        <a href="{{ url('', {'lang': code}) }}">
                          {{ name[1]|default(name[0]) }}
                        </a>
                      </li>
                  {% endfor %}
                </ul>
              </div>
          {% endif %}
        </div>
      </div> 
      {% if messages is not empty %}
          <div class="row">
            <div class="col-md-12">
              {% for type,strings in messages %}
                  <div class="alert alert-{{ type }} alert-dismissible fade in">
                    <button type="button" class="close" data-dismiss="alert">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    {% for string in strings %}
                        {{ string|raw }}
                    {% endfor %}
                  </div>
              {% endfor %}
            </div>
          </div>
      {% endif %}
      <div class="row">
        {% if severity != 'danger' %}
            <div class="col-md-8">
              <div class="panel panel-default">
                <div class="panel-body">
                  {% if error('database.connect', true) %}
                      <div class="alert alert-warning alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert">
                          <span aria-hidden="true">&times;</span>
                        </button>
                        {{ error('database.connect') }}
                      </div>
                  {% endif %}
                  <div class="required form-group{{ error('database.name', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('Database name') }}</label>
                    <div class="col-md-4">
                      <input name="settings[database][name]" class="form-control" value="{{ settings['database']['name'] ?? '' }}">
                      <div class="help-block">
                        {{ error('database.name') }}
                      </div>
                    </div>
                    <div class="col-md-5">{{ text('A name of the database you want to connect to') }}</div>
                  </div>
                  <div class="required form-group{{ error('database.user', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('Database user') }}</label>
                    <div class="col-md-4">
                      <input name="settings[database][user]" class="form-control" value="{{ settings['database']['user'] ?? 'root' }}">
                      <div class="help-block">
                        {{ error('database.user') }}
                      </div>
                    </div>
                    <div class="col-md-5">
                      {{ text('An existing username to access the database') }}
                    </div>
                  </div>
                  <div class="form-group{{ error('database.password', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('Database password') }}</label>
                    <div class="col-md-4">
                      <input type="password" name="settings[database][password]" class="form-control" value="{{ settings['database']['password'] ?? '' }}">
                      <div class="help-block">
                        {{ error('database.password') }}
                      </div>
                    </div>
                    <div class="col-md-5">{{ text('A password to access the database. Can be empty') }}</div>
                  </div>
                  {% if error(null, true) is empty %}
                      <div class="form-group">
                        <div class="col-md-5 col-md-offset-3">
                          <a href="#db-advanced" data-toggle="collapse">{{ text('Advanced') }} <span class="caret"></span></a>
                        </div>
                      </div>
                  {% endif %}
                  <div id="db-advanced" class="{{ error(null, '', 'collapse') }}">
                    <div class="form-group">
                      <label class="col-md-3 control-label">{{ text('Database type') }}</label>
                      <div class="col-md-4">
                        <select name="settings[database][type]" class="form-control">
                          <option value="mysql"{{ settings['database']['type'] is defined and settings['database']['type'] == 'mysql' ? ' selected' }}>{{ text('mysql') }}</option>
                          <option value="sqlite"{{ settings['database']['type'] is defined and settings['database']['type'] == 'sqlite' ? ' selected' }}>{{ text('sqlite') }}</option>
                        </select>
                      </div>
                    </div>
                    <div class="required form-group{{ error('database.port', ' has-error') }}">
                      <label class="col-md-3 control-label">{{ text('Database port') }}</label>
                      <div class="col-md-4">
                        <input name="settings[database][port]" class="form-control" value="{{ settings['database']['port'] ?? '3306' }}">
                        <div class="help-block">{{ error('database.port') }}</div>
                      </div>
                    </div>
                    <div class="required form-group{{ error('database.host', ' has-error') }}">
                      <label class="col-md-3 control-label">{{ text('Database host') }}</label>
                      <div class="col-md-4">
                        <input name="settings[database][host]" class="form-control" value="{{ settings['database']['host'] ?? 'localhost'}}">
                        <div class="help-block">{{ error('database.host') }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> 
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="required form-group{{ error('user.email', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('E-mail') }}</label>
                    <div class="col-md-4">
                      <input name="settings[user][email]" class="form-control" value="{{ settings['user']['email'] ?? '' }}">
                      <div class="help-block">
                        {{ error('user.email') }}
                      </div>
                    </div>
                    <div class="col-md-5">{{ text('An E-mail for superadmin') }}</div>
                  </div>
                  <div class="required form-group{{ error('user.password', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('Password') }}</label>
                    <div class="col-md-4">
                      <input type="password" name="settings[user][password]" class="form-control" value="{{ settings['user']['password'] ?? '' }}">
                      <div class="help-block">
                        {{ error('user.password') }}
                      </div>
                    </div>
                    <div class="col-md-5">{{ text('A password for superadmin') }}</div>
                  </div>
                  <div class="required form-group{{ error('store.title', ' has-error') }}">
                    <label class="col-md-3 control-label">{{ text('Store title') }}</label>
                    <div class="col-md-4">
                      <input name="settings[store][title]" class="form-control" value="{{ settings['store']['title'] ?? 'GPL Cart' }}">
                      <div class="help-block">
                        {{ error('store.title') }}
                      </div>
                    </div>
                    <div class="col-md-5">{{ text('A name of the store') }}</div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-3 control-label">{{ text('Timezone') }}</label>
                    <div class="col-md-4">
                      <select name="settings[store][timezone]" class="form-control">
                        {% for value,label in timezones %}
                            <option value="{{ value }}"{{ (settings['store']['timezone'] is defined and settings['store']['timezone'] == value) ? ' selected'}}>{{ label }}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-md-5">{{ text('Choose your local timezone') }}</div>
                  </div>
                </div>
              </div> 
              <div class="form-group">
                <div class="col-md-12 text-right">    
                  <button class="btn btn btn-default" name="install" value="1">{{ text('Install') }}</button>  
                </div>
              </div>
            </div>
        {% endif %}
        <div class="{{ severity == 'danger' ? 'col-md-12' : 'col-md-4' }}">
          <table class="table-condensed requirements">
            <tbody>
              {% for section,items in requirements %}
                  {% for name,info in items %}
                      <tr class="{{ info['status'] ? '' : ' bg-' ~ info['severity'] }}">
                        <td>{{ text(info['message']) }}</td>
                        <td> {{ info['status'] ? '<i class="fa fa-check-square-o"></i>' : '<i class="fa fa-square-o"></i>' }}</td>
                        <td>
                          {% if not info['status'] %}
                              {% if info['severity'] == 'warning' %}
                                  {{ text('non-critical') }}
                              {% elseif info['severity'] == 'danger' %}
                                  {{ text('critical') }}
                              {% endif %}
                          {% endif %}
                        </td>
                      </tr>
                  {% endfor %}
              {% endfor %}
            </tbody>
          </table>
          {% if severity == 'danger' %}
              <p><b>{{ text('Please fix all critical errors in your environment before continue') }}</b></p>
          {% endif %}
        </div>
      </div>
    </form>            
  </div>                
</body>